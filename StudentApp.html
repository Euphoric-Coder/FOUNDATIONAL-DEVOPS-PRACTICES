<!-- 
    Student Name: Sagnik Dey
    BITS Student ID: 2023EBCS536 
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2023EBCS536</title>
    <style>
      /* Gave Styling to the Form additionally for asthetics purpose  */
      * {
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Courier New", Courier, monospace;
        background-color: #f0f8ff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        padding: 0;
      }

      /* Styling of Form Container */
      .form {
        background-color: white;
        padding: 30px;
        border-radius: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        margin: 20px;
      }

      /* Form Title Styling */
      h1 {
        font-family: Arial, Helvetica, sans-serif;
        text-align: center;
        color: #004080;
      }

      /* Form Label Styling */
      label {
        font-weight: bold;
        color: #333;
        display: block;
        margin-bottom: 5px;
      }

      /* Input Field Styling */
      input {
        background-color: #ffffff;
        color: #333333;
        border: 3.5px solid #b0cbe4;
        border-radius: 40px;
        padding: 10px;
        width: 100%;
        margin-bottom: 15px;
        font-size: 16px;
        /* To Ensure padding is included in width */
        box-sizing: border-box;
      }

      /* Button Styling */
      button {
        background-color: whitesmoke;
        border: 3.5px solid #0b7ee9;
        border-radius: 15px;
        padding: 5px 10px;
        font-size: 14px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-weight: bold;
        width: 100%;
        cursor: pointer;
        margin-top: 10px;
      }

      /* Button Hover Styling */
      button:hover {
        background-color: #d1e7fe;
        transform: scale(1.05);
      }

      /* Button Press Styling */
      button:active {
        background-color: #b9dffa;
        transform: scale(0.99);
        border: 3.5px solid #0b7ee9;
      }

      /* Input Field Focus Styling */
      input:focus {
        border-color: #0066cc;
        outline: none;
      }

      /* Input Field Placeholder Styling */
      input::placeholder {
        font-size: 15px;
        font-style: italic;
      }
      /* Error Message Styling */
      .error-message {
        color: red;
        font-size: 12px;
        /* Is kept hidden by default */
        display: none;
      }

      /* Error Input Field Styling */
      input.error {
        border-color: red;
      }

      /* Media Queries for Responsiveness */

      /* Mobile Devices */
      @media (max-width: 280px) {
        .form {
          padding: 20px;
          width: 90%;
          margin: 0 auto;
        }

        h1 {
          font-size: 24px;
        }

        input {
          font-size: 14px;
        }

        button {
          font-size: 14px;
        }
      }

      /* Tablets */
      @media (min-width: 481px) and (max-width: 768px) {
        .form {
          padding: 25px;
          width: 85%;
        }

        h1 {
          font-size: 28px;
        }

        input {
          font-size: 16px;
        }

        button {
          font-size: 16px;
        }
      }

      /* Laptops and Desktops */
      @media (min-width: 769px) and (max-width: 1200px) {
        .form {
          max-width: 600px;
        }
      }

      /* Extra-Large Screens */
      @media (min-width: 1201px) {
        .form {
          max-width: 800px;
        }

        h1 {
          font-size: 32px;
        }

        input {
          font-size: 18px;
        }

        button {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div class="form">
        
      <button class="back-btn" onclick="window.location.href='index.html'">
        ← Back to Main Page
      </button>

      <h1>Student ID Card Application</h1>

      <!-- Student ID Card Application Form  -->
      <form id="studentForm">
        <label for="name">Name:</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="Enter your name"
          required
        />
        <!-- This tag is for the error message  -->
        <span class="error-message" id="nameError"></span><br /><br />

        <label for="dob">Date of Birth:</label>
        <input
          type="text"
          id="dob"
          name="dob"
          placeholder="Enter DOB in format dd/mm/yyyy"
          required
        />
        <!-- This tag is for the error message  -->
        <span class="error-message" id="dobError"></span><br /><br />

        <label for="age">Age:</label>
        <input type="text" id="age" name="age" readonly />

        <label for="mobile">Mobile Number:</label>
        <input
          type="text"
          id="mobile"
          name="mobile"
          placeholder="Enter a 10 digit valid Mobile Number only"
          required
        />
        <!-- This tag is for the error message  -->
        <span class="error-message" id="mobileError"></span><br /><br />

        <label for="email">Email ID:</label>
        <input
          type="text"
          id="email"
          name="email"
          placeholder="Enter a valid E-Mail Address only"
          required
        />
        <!-- This tag is for the error message  -->
        <span class="error-message" id="emailError"></span><br /><br />

        <button type="button" id="submitBtn">Submit</button>
      </form>

      <!-- Form Data Display Section after Retrieving Cookie with Mob. No. -->
      <!-- Initially the display is hidden -->
      <div id="showData" style="display: none">
        <h1>Retrieve Student Information</h1>
        <label for="registeredMobileNumber">Enter Mobile Number:</label>
        <input
          type="text"
          id="registeredMobileNumber"
          placeholder="Enter Mobile Number"
        />
        <span class="error-message" id="showRetrieveError"></span><br /><br />
        <button id="showButton">Retrieve Cookie</button>
        <button
          id="backButton"
          style="margin-top: 15px; background-color: #e8f3ff"
        >
          ← Back to Student Details Page
        </button>
      </div>
    </div>

    <script>
      // StudentData class is created to store form details
      class StudentData {
        constructor(name, dob, age, mobile, email) {
          this.name = name;
          this.dob = dob;
          this.age = age;
          this.mobile = mobile;
          this.email = email;
        }
      }

      document.getElementById("submitBtn").addEventListener("click", storeData);
      document.getElementById("showButton").addEventListener("click", showData);
      document
        .getElementById("name")
        .addEventListener("focusout", validateName);
      document.getElementById("dob").addEventListener("focusout", validateDOB);
      document
        .getElementById("mobile")
        .addEventListener("focusout", validateMobile);
      document
        .getElementById("email")
        .addEventListener("focusout", validateEmail);
      document.getElementById("backButton").addEventListener("click", () => {
        showFormSection();
        history.pushState({ page: "form" }, "Student Form", "#form");
      });

      // To manage navigation between form and retrieve cookie sections
      window.addEventListener("popstate", handleNavigation);

      // This function validates the name given by the user in the form
      function validateName() {
        const name = document.getElementById("name").value;
        const nameError = document.getElementById("nameError");
        const patternOfName = /^[A-Za-z\s]+$/;

        if (!patternOfName.test(name) || name.trim() === "") {
          nameError.style.display = "block";
          nameError.textContent =
            "Invalid Name: Only alphabets and spaces allowed.";
          document.getElementById("name").classList.add("error");
          return false;
        } else {
          nameError.style.display = "none";
          document.getElementById("name").classList.remove("error");
          return true;
        }
      }

      // This function validates the Date of Birth given by the user in the form
      function validateDOB() {
        const dob = document.getElementById("dob").value;
        const dobError = document.getElementById("dobError");
        const patternOfDOB = /^(\d{2})\/(\d{2})\/(\d{4})$/;

        if (!patternOfDOB.test(dob)) {
          dobError.style.display = "block";
          dobError.textContent =
            "Invalid Date of Birth: Enter in dd/mm/yyyy format.";
          document.getElementById("dob").classList.add("error");
          // The Age Field is kept empty if dob not valid
          document.getElementById("age").value = "";
          return false;
        } else {
          dobError.style.display = "none";
          document.getElementById("dob").classList.remove("error");
          findAge(dob);
          return true;
        }
      }

      // This function is used to deduce the age of a valid dob
      function findAge(dob) {
        const [day, month, year] = dob.split("/");
        const dobDate = new Date(`${year}-${month}-${day}`);
        const ageDate = new Date(Date.now() - dobDate.getTime());
        const age = Math.abs(ageDate.getUTCFullYear() - 1970);
        document.getElementById("age").value = age;
      }

      // This function validates the Mobile Number entered by the user in the form
      function validateMobile() {
        const mobile = document.getElementById("mobile").value;
        const mobileError = document.getElementById("mobileError");
        const patternOfMobileNo = /^[1-9][0-9]{9}$/;

        if (!patternOfMobileNo.test(mobile)) {
          mobileError.style.display = "block";
          mobileError.textContent =
            "Invalid Mobile Number: Must be 10 digits and cannot start with 0.";
          document.getElementById("mobile").classList.add("error");
          return false;
        } else {
          mobileError.style.display = "none";
          document.getElementById("mobile").classList.remove("error");
          return true;
        }
      }

      // This function validates the E-Mail Address given by the user in the form
      function validateEmail() {
        const email = document.getElementById("email").value;
        const emailError = document.getElementById("emailError");
        const patternOfEmail = /^[^\@]+\@[^\@]+\.(com|in)$/;

        if (!patternOfEmail.test(email)) {
          emailError.style.display = "block";
          emailError.textContent =
            "Invalid Email: Must contain '@' and end with '.com' or '.in'.";
          document.getElementById("email").classList.add("error");
          return false;
        } else {
          emailError.style.display = "none";
          document.getElementById("email").classList.remove("error");
          return true;
        }
      }

      // This function stores form data in a cookie after creating a StudentData class instance
      function storeData() {
        // Check if all form fields are valid before storing data
        if (
          validateName() &&
          validateDOB() &&
          validateMobile() &&
          validateEmail()
        ) {
          // Create an object of StudentData class with form input values
          const student = new StudentData(
            document.getElementById("name").value,
            document.getElementById("dob").value,
            document.getElementById("age").value,
            document.getElementById("mobile").value,
            document.getElementById("email").value
          );

          // Sets expiration of the cookie to 14 days from now
          const expirationDate = new Date();
          expirationDate.setTime(
            expirationDate.getTime() + 14 * 24 * 60 * 60 * 1000
          );
          const expires = `expires=${expirationDate.toUTCString()}`;

          // Stores student object in a cookie with expiration and path
          document.cookie = `student=${JSON.stringify(
            student
          )}; ${expires}; path=/`;

          // Change URL and history state to reflect the retrieve section
          history.pushState(
            { page: "retrieve" },
            "Retrieve Cookie",
            "#retrieve"
          );
          console.log("Data Stored");
          // Shows retrieve section after submission
          showRetrieveSection();
        }
      }

      // This function retrieves student details from cookie based on valid mobile number input
      function showData() {
        const mobileInput = document.getElementById(
          "registeredMobileNumber"
        ).value;
        const showRetrieveError = document.getElementById("showRetrieveError");
        const cookies = document.cookie
          .split(";")
          .find((cookie) => cookie.trim().startsWith("student="));

        if (cookies) {
          const student = JSON.parse(cookies.split("=")[1]);
          if (student.mobile === mobileInput) {
            alert(
              `Name: ${student.name}\nDOB: ${student.dob}\nAge: ${student.age}\nMobile: ${student.mobile}\nEmail: ${student.email}`
            );
          } else {
            showRetrieveError.style.display = "block";
            showRetrieveError.textContent = "Mobile number not found.";
          }
        } else {
          showRetrieveError.style.display = "block";
          showRetrieveError.textContent = "No data found.";
        }
      }

      // This function shows the retrieve cookie section and hide the student form section
      function showRetrieveSection() {
        document.getElementById("studentForm").style.display = "none";
        document.getElementById("showData").style.display = "block";
      }

      // This function shows the form section and hide the retrieve section
      function showFormSection() {
        document.getElementById("showData").style.display = "none";
        document.getElementById("studentForm").style.display = "block";
      }

      // This function handles browser back/forward navigation using popstate event
      // This also restricts the user to reset the retrieve cookies part if reloaded the webpage by mistake
      function handleNavigation(event) {
        if (event.state && event.state.page === "retrieve") {
          showRetrieveSection();
        } else {
          showFormSection();
        }
      }

      // Initial page load handler based on URL
      window.onload = function () {
        if (window.location.hash === "#retrieve") {
          showRetrieveSection();
        } else {
          showFormSection();
        }
      };
    </script>
  </body>
</html>
